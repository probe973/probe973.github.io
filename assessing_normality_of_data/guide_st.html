<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessing Normality in Stata</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- MathJax for LaTeX rendering -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          // ONLY use \( \) for inline math and \[ \] for display math
          inlineMath: [['\\(','\\)']],
          displayMath: [['\\[','\\]']],
          // Do not process content within <pre> or <code> tags that have this class
          ignoreHtmlClass: "no-mathjax-process",
          processEscapes: true // Allows for \$ to render a literal dollar sign if needed
        },
        // After the DOM is ready, queue the typesetting.
        // This ensures all content is loaded before MathJax tries to process it.
        skipStartupTypeset: true
      });

      window.onload = function () {
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
      };
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <style>
        /* Merged Styles */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            color: #222;
            background-color: #f8f8f8;
            line-height: 1.6;
        }
        .container {
            padding: 25px;
            max-width: 960px;
            margin: 30px auto;
            background-color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        h1 {
            color: #004085;
            border-bottom: 3px solid #004085;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 2.2em;
            font-family: 'Inter', sans-serif; /* Explicitly set font */
        }
        h2 {
            color: #004085;
            margin-top: 35px;
            font-size: 1.8em;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
            font-family: 'Inter', sans-serif; /* Explicitly set font */
        }
        h3 {
            color: #0056b3;
            font-size: 1.2em;
            border-bottom: 1px solid #eee;
            margin-top: 25px;
            font-family: 'Inter', sans-serif; /* Explicitly set font */
        }
        h4 {
            color: #0056b3;
            font-size: 1em;
            margin-top: 25px;
            font-family: 'Inter', sans-serif; /* Explicitly set font */
        }
        .subtitle {
            color: #444;
            font-size: 1.2em;
            margin-bottom: 25px;
            font-family: 'Inter', sans-serif; /* Explicitly set font */
        }
        code {
            background-color: #eef;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: "Courier New", Courier, monospace;
            color: #c00; /* Red color for actual code snippets */
        }
        /* Ensure paragraphs and list items within the container are dark and use the Inter font */
        .container p, .container ul li, .container ol li {
            color: #222;
            font-family: 'Inter', sans-serif;
        }
        pre {
            background-color: #eef;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap; /* Ensures text wraps */
            word-wrap: break-word; /* Breaks long words */
            font-family: "Courier New", Courier, monospace;
            color: #333;
            border: 1px solid #ddd;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            color: #333;
            font-weight: bold;
        }
        ul {
            list-style-type: disc;
            margin-left: 20px;
        }
        ol {
            list-style-type: decimal;
            margin-left: 20px;
        }
        .reflection-question {
            background-color: #f0f8ff;
            border-left: 5px solid #add8e6;
            padding: 10px 15px;
            margin: 15px 0;
        }
        .write-up-template {
            background-color: #e9f5e9;
            border-left: 5px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
        }
        .write-up-template p {
            margin-bottom: 10px;
        }
        .solution-section {
            background-color: #f0fff0;
            border-left: 5px solid #6b8e23;
            padding: 10px 15px;
            margin: 15px 0;
        }
        .solution-section h4 {
            color: #6b8e23;
        }
        .top-nav {
            display: flex;
            justify-content: flex-start;
            gap: 15px;
            padding: 15px;
            background-color: #004085;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            align-items: center;
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 1000;
            flex-wrap: wrap; /* Allow items to wrap */
        }
        .top-nav span {
            color: white;
            font-weight: bold;
            margin-right: 5px;
            font-family: 'Inter', sans-serif; /* Explicitly set font */
        }
        .top-nav a {
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            white-space: nowrap;
        }
        .top-nav a:hover {
            background-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-1px);
        }
        hr {
            border: 0;
            height: 2px;
            background: #e0e0e0;
            margin: 40px 0;
        }
    </style>
</head>
<body>
    <div class="top-nav">
        <span>Links to:</span>
        <a href="../index.html">Home</a>
        <a href="../stata.html">Stata Guides</a>
    </div>
    <div class="container">
        <h1>Assessing Normality in Stata</h1>
        <p class="subtitle">A Guide to Checking Data Distribution for Statistical Analysis using Stata</p>

        <p>This guide will walk you through the process of assessing whether your data is "normally distributed" using Stata. Understanding the distribution of your data, especially its normality, is a critical step in statistical analysis. Many common statistical tests (called <strong>parametric tests</strong>) assume that the data for the variables you are analyzing follow a normal (bell-shaped) distribution. If your data significantly deviates from normality, using these tests might lead to inaccurate conclusions.</p>

        <p>If your data is not normally distributed, you might need to consider <strong>non-parametric tests</strong> (which do not assume normality) or transform your data to make it more normal. Checking normality helps you decide the most appropriate statistical test for your research questions.</p>

        <p>Before you begin, ensure you have your <code class="no-mathjax-process">omni.csv</code> file available. Throughout this guide, we will use specific variables from your dataset to illustrate the concepts:</p>
        <ul>
            <li><code class="no-mathjax-process">final_exam_score</code>: Represents the numerical score achieved by students on a final exam.</li>
            <li><code class="no-mathjax-process">study_hours_per_week</code>: Indicates the number of hours a student reported studying each week.</li>
            <li><code class="no-mathjax-process">anxiety_score_pre</code>: Anxiety level before a study intervention.</li>
            <li><code class="no-mathjax-process">used_study_support_services</code>: A categorical variable indicating whether a student utilized study support services (Yes/No). This variable will be used to demonstrate assessing normality for groups.</li>
        </ul>
        <p>First, load your data into Stata. Assuming <code class="no-mathjax-process">omni.csv</code> is in your working directory:</p>
        <p>
            Lines beginning with a <code class="no-mathjax-process">*</code> are comments, to give any information you want, and don't need to be entered into the command prompt. It is useful to use these comments if you are using a Stata do file.
        </p>
        <pre class="no-mathjax-process"><code>
* Clear any existing data from memory
clear all

* Set your working directory (uncomment and modify if needed)
* cd "C:/Users/YourUser/YourDataFolder"

* Import the CSV file
import delimited using "omni.csv", clear

* Display the first few rows to check the data
list in 1/5
        </code></pre>
        <p>
            The <code class="no-mathjax-process">clear all</code> command clears any data or settings from Stata's memory. The <code class="no-mathjax-process">cd</code> command (change directory) allows you to set your working directory, which is important so Stata can find your data file. The <code class="no-mathjax-process">import delimited</code> command is used to load data from a CSV (Comma Separated Values) file into Stata's memory; the <code class="no-mathjax-process">clear</code> option tells Stata to clear any existing data before loading. Finally, <code class="no-mathjax-process">list in 1/5</code> displays the first five rows, useful for a quick check of your data's structure and content.
        </p>

        <hr>

        <h2>Part 1: Assessing Normality for a Single Interval/Ratio Variable (Whole Sample)</h2>
        <p>We will start by examining the normality of <code class="no-mathjax-process">final_exam_score</code> for the entire dataset using various methods.</p>

        <h3>1.1 Using Summary Statistics: Skewness and Kurtosis (and their Z-scores)</h3>
        <p>Skewness and Kurtosis are numerical measures that describe the shape of your data's distribution. They can provide initial hints about normality. Stata's <code class="no-mathjax-process">summarize, detail</code> command is useful for obtaining these values.</p>
        <ol>
            <li>Use the <code class="no-mathjax-process">summarize</code> command with the <code class="no-mathjax-process">detail</code> option on your variable.</li>
            <p><strong>Menu Driven:</strong> <code>Statistics > Summaries, tables, and tests > Summary and descriptive statistics > Summary statistics</code>. Select <code class="no-mathjax-process">final_exam_score</code> and check "Display additional statistics (e.g., skewness, kurtosis)".</p>
            <pre class="no-mathjax-process"><code>
* Get descriptive statistics including skewness and kurtosis
summarize final_exam_score, detail
            </code></pre>
            <p><strong>Example Output (excerpt for <code class="no-mathjax-process">final_exam_score</code>):</strong></p>
            <pre class="no-mathjax-process"><code>
    Percentiles      Smallest
    1%       60            60
    5%       66            60
   10%       68            61       Obs                  100
   25%       70            62       Sum of Wgt.          100

   50%       75                   Mean               74.71
   75%       79                   Std. dev.           5.764835
   90%       83
   95%       85       Largest   Variance           33.23323
   99%       89            89       Skewness            0.0033621
                         89       Kurtosis            2.86877
            </code></pre>
            <p>
                In this output, <code class="no-mathjax-process">Skewness</code> is the skewness value and <code class="no-mathjax-process">Kurtosis</code> is the kurtosis value. Note that Stata's <code class="no-mathjax-process">summarize, detail</code> output specifically reports <strong>raw kurtosis</strong>, where a value of 3 indicates a normal distribution.
            </p>
        </ol>
        <p><strong>Interpretation:</strong></p>
        <ul>
            <li><strong>Skewness:</strong> A value of 0 indicates perfect symmetry. Positive values mean a tail to the right (data clustered on the left), and negative values mean a tail to the left (data clustered on the right). For a normal distribution, skewness should be close to 0.</li>
            <li><strong>Kurtosis:</strong> A value of 3 indicates peakedness similar to a normal distribution (mesokurtic). Values greater than 3 (leptokurtic) mean a more peaked distribution with fatter tails (more outliers), while values less than 3 (platykurtic) mean a flatter distribution with thinner tails. For a normal distribution, raw kurtosis should be close to 3.</li>
            <li><strong>Standardised Skewness/Kurtosis (Z-scores):</strong> To formally assess if skewness and kurtosis deviate significantly from normal, you can convert them to Z-scores. The standard errors for skewness and kurtosis are approximated based on your sample size (\(N\)):
                <ul>
                    <li>Standard Error of Skewness (\(SE_{\text{skew}}\)) is approximately \(\sqrt{\frac{6}{N}}\).</li>
                    <li>Standard Error of Kurtosis (\(SE_{\text{kurt}}\)) is approximately \(\sqrt{\frac{24}{N}}\).</li>
                    <li>For \(N=100\) in our dataset:
                        <ul>
                            <li>\(SE_{\text{skew}} \approx \sqrt{\frac{6}{100}} = 0.2449\).</li>
                            <li>\(SE_{\text{kurt}} \approx \sqrt{\frac{24}{100}} = 0.4899\).</li>
                        </ul>
                    </li>
                    <li>The Z-score for skewness is calculated as:
                        \[Z_{\text{skew}} = \frac{\text{Skewness}}{\text{SE}_{\text{skew}}}\]</li>
                    <li>The Z-score for kurtosis is calculated as:
                        \[Z_{\text{kurt}} = \frac{\text{Kurtosis} - 3}{\text{SE}_{\text{kurt}}}\]
                        (Subtracting 3 adjusts Stata's raw kurtosis to an 'excess kurtosis' value, where 0 is normal).</li>
                    <li>If the absolute value of the Z-score for both skewness and kurtosis is <strong>less than 1.96</strong> (i.e., between \(-1.96\) and \(+1.96\)), the distribution is considered sufficiently normal for most practical purposes at a \(p < 0.05\) significance level. Values outside this range suggest significant deviation from normality.</li>
                </ul>
            </li>
        </ul>

        <h3>1.2 Visual Assessment with Histograms</h3>
        <p>A histogram allows you to visually inspect the shape of your data's distribution. A truly normal distribution will look like a symmetric bell curve. Stata's <code class="no-mathjax-process">histogram</code> command can overlay a normal density curve.</p>
        <p><strong>Menu Driven:</strong> <code>Graphics > Histogram...</code> Select <code class="no-mathjax-process">final_exam_score</code>, then check "Add normal density plot".</p>
        <pre class="no-mathjax-process"><code>
* Create a histogram with a normal density overlay
histogram final_exam_score, normal title("Histogram of Final Exam Scores with Normal Curve") ///
   xtitle("Final Exam Score") ytitle("Density")
graph export "final_exam_score_histogram.png", as(png) replace
            </code></pre>
        <p>
            The <code class="no-mathjax-process">histogram</code> command plots a histogram. The <code class="no-mathjax-process">normal</code> option overlays a normal density curve. <code class="no-mathjax-process">title()</code>, <code class="no-mathjax-process">xtitle()</code>, and <code class="no-mathjax-process">ytitle()</code> set the plot title and axis labels. The <code class="no-mathjax-process">///</code> at the end of a line is Stata's way to indicate that the command continues on the next line. <code class="no-mathjax-process">graph export</code> saves the generated graph to a file.
        </p>
        <p><strong>Visual Interpretation:</strong> Look for symmetry, a single peak in the middle, and tails that taper off evenly on both sides. Compare the bars to the overlaid normal curve.</p>

        <h3>1.3 Visual Assessment with Q-Q Plots (Quantile-Quantile Plots)</h3>
        <p>Q-Q plots are a powerful visual tool for assessing normality. They plot the quantiles of your data against the quantiles of a theoretical normal distribution. If your data is normally distributed, the points will fall approximately along a straight diagonal line.</p>
        <p><strong>Menu Driven:</strong> <code>Graphics > Quantile-normal plot...</code> Select <code class="no-mathjax-process">final_exam_score</code>.</p>
        <pre class="no-mathjax-process"><code>
* Create a Q-Q plot for final_exam_score
qnorm final_exam_score, title("Normal Q-Q Plot of Final Exam Scores") ///
   xtitle("Normal Quantiles") ytitle("Final Exam Score")
graph export "final_exam_score_qqplot.png", as(png) replace
            </code></pre>
        <p>
            The <code class="no-mathjax-process">qnorm</code> command generates a normal quantile-normal plot (similar to a Q-Q plot). If the data points fall approximately along the 45-degree reference line, it suggests a normal distribution.
        </p>
        <p><strong>Visual Interpretation:</strong></p>
        <ul>
            <li>If points generally follow the diagonal line, the data is likely normal.</li>
            <li>Deviations from the line, especially at the ends, indicate non-normality (e.g., S-shapes for skewness, tails curving away for kurtosis).</li>
        </ul>

        <h3>1.4 Statistical Test for Normality: Shapiro-Wilk Test</h3>
        <p>While visual inspection is important, statistical tests provide a numerical assessment of normality. The Shapiro-Wilk test is widely used for this purpose. In Stata, the <code class="no-mathjax-process">shapiro</code> command (a user-written command) can perform this test. If you don't have it installed, first run <code class="no-mathjax-process">ssc install shapiro</code>.</p>
        <p><strong>Menu Driven:</strong> Not directly available from a standard menu, as it's a user-written command. You would run it via the command line or Do-file editor.</p>
        <pre class="no-mathjax-process"><code>
* Install shapiro command if not already installed
ssc install shapiro, replace

* Perform the Shapiro-Wilk Normality Test
shapiro final_exam_score
            </code></pre>
        <p><strong>Interpretation of Shapiro-Wilk Test:</strong></p>
        <ul>
            <li><strong>Null Hypothesis (H<sub>0</sub>):</strong> The data is normally distributed.</li>
            <li><strong>Alternative Hypothesis (H<sub>1</sub>):</strong> The data is NOT normally distributed.</li>
            <li>If the <strong>p-value is greater than or equal to your significance level (e.g., \(p \ge 0.05\))</strong>, you <strong>do not reject the null hypothesis</strong>. This suggests there is not enough evidence to conclude that the data is non-normal, so it can be considered normal for practical purposes.</li>
            <li>If the <strong>p-value is less than your significance level (e.g., \(p < 0.05\))</strong>, you <strong>reject the null hypothesis</strong>. This suggests there is evidence that the data is NOT normally distributed.</li>
            <li><strong>Important Note:</strong> For very large sample sizes, the Shapiro-Wilk test can show a statistically significant deviation from normality even for minor, practically irrelevant deviations. Always combine the statistical test results with visual inspections (histograms, Q-Q plots) and also consider the Z-scores for skewness and kurtosis. For small samples, the test might not be powerful enough to detect non-normality.</li>
        </ul>

        <div class="reflection-question">
            <h4>Reflection Questions & Tasks (Part 1):</h4>
            <ol>
                <li>For <code class="no-mathjax-process">final_exam_score</code>, examine its <code class="no-mathjax-process">Skewness</code> and <code class="no-mathjax-process">Kurtosis</code> values from the <code class="no-mathjax-process">summarize, detail</code> output. Are they close to 0 (for skewness) and 3 (for kurtosis)? What does this suggest about its distribution shape?</li>
                <li>Calculate the Z-scores for Skewness and Kurtosis for <code class="no-mathjax-process">final_exam_score</code> using the formulas provided. Based on these Z-scores, do they suggest significant skewness or kurtosis?</li>
                <li>Look at the histogram and Q-Q plot for <code class="no-mathjax-process">final_exam_score</code>. Do they visually support the numerical measures of skewness and kurtosis? How would you describe the distribution of final exam scores based on these plots?</li>
                <li>What is the p-value for the Shapiro-Wilk test for <code class="no-mathjax-process">final_exam_score</code>? If \(p \ge 0.05\), what does this imply about the normality of the data?</li>
                <li><strong>Task:</strong> Now, repeat the steps in Sections 1.1 to 1.4 for the variable <code class="no-mathjax-process">study_hours_per_week</code>. How do its summary statistics (Skewness, Kurtosis), calculated Z-scores, visual plots (Histogram, Q-Q plot), and the Shapiro-Wilk p-value compare to those of <code class="no-mathjax-process">final_exam_score</code>? Does <code class="no-mathjax-process">study_hours_per_week</code> appear normally distributed? Why or why not?</li>
            </ol>
        </div>

        <div class="solution-section">
            <h4>Suggested Solutions for Reflection Questions (Part 1):</h4>
            <ol>
                <li>For <code class="no-mathjax-process">final_exam_score</code>, you will find Skewness = 0.003 and Kurtosis = 2.869. This suggests the distribution is very close to symmetrical (skewness near 0) and its peakedness is very similar to a normal distribution (kurtosis near 3).</li>
                <li>For <code class="no-mathjax-process">final_exam_score</code>, with \(N=100\), \(SE_{\text{skew}} \approx 0.2449\) and \(SE_{\text{kurt}} \approx 0.4899\).
                    \(Z_{\text{skew}} = \frac{0.0033621}{0.2449} \approx 0.01\).
                    \(Z_{\text{kurt}} = \frac{2.86877 - 3}{0.4899} = \frac{-0.13123}{0.4899} \approx -0.27\).
                    Both absolute Z-scores are well below 1.96, indicating no statistically significant skewness or kurtosis.</li>
                <li>The histogram for <code class="no-mathjax-process">final_exam_score</code> will look roughly bell-shaped and symmetrical, with the normal curve fitting well. The Q-Q plot's points will fall closely along the diagonal line. Both visuals support the idea that the data is approximately normally distributed.</li>
                <li>For <code class="no-mathjax-process">final_exam_score</code>, the Shapiro-Wilk p-value will be 0.99 (or very close to 1). This implies that we do not reject the null hypothesis, meaning the <code class="no-mathjax-process">final_exam_score</code> data can be considered normally distributed.</li>
                <li><strong>Task Solution (for <code class="no-mathjax-process">study_hours_per_week</code>):</strong>
                    <ul>
                        <li>Using <code class="no-mathjax-process">summarize study_hours_per_week, detail</code>: You will find Skewness = 0.603 and Kurtosis = 3.066. The positive skewness suggests a noticeable tail to the right. The kurtosis is close to 3.</li>
                        <li>With \(N=100\):
                            \(SE_{\text{skew}} \approx \sqrt{\frac{6}{100}} = 0.2449\).
                            \(SE_{\text{kurt}} \approx \sqrt{\frac{24}{100}} = 0.4899\).
                            \(Z_{\text{skew}} = \frac{0.603}{0.2449} \approx 2.46\). Since \(|2.46| > 1.96\), this suggests statistically significant positive skewness.
                            \(Z_{\text{kurt}} = \frac{3.066 - 3}{0.4899} \approx 0.13\). This is not significant.</li>
                        <li>The histogram will show a clear positive skew (more bars on the left, tail extending right), and the normal curve will not fit perfectly. The Q-Q plot will show points significantly deviating from the line at the upper end, particularly on the right side, indicating positive skewness.</li>
                        <li>The Shapiro-Wilk p-value will be 0.001 (or very small, e.g., \(< 0.0001\)). This means we reject the null hypothesis, suggesting <code class="no-mathjax-process">study_hours_per_week</code> is <strong>not</strong> normally distributed.</li>
                    </ul>
                    The significant skewness (from Z-score calculation), combined with the low p-value from the Shapiro-Wilk test and visual cues, strongly supports the conclusion that <code class="no-mathjax-process">study_hours_per_week</code> is not normally distributed.</li>
            </ol>
        </div>

        <hr>

        <h2>Part 2: Assessing Normality for an Interval/Ratio Variable (Split by Groups)</h2>
        <p>Sometimes, a variable might appear normally distributed in the overall sample, but its distribution might differ when examined within specific subgroups. This is important to check if you plan to compare groups using parametric tests. We will use Stata's <code class="no-mathjax-process">by</code> prefix and graphing commands.</p>
        <p>We will assess the normality of <code class="no-mathjax-process">final_exam_score</code> again, but this time split by <code class="no-mathjax-process">used_study_support_services</code> (Yes/No).</p>

        <h3>2.1 Grouped Summary Statistics and Plots</h3>
        <p>Ensure the data is sorted by the grouping variable when using <code class="no-mathjax-process">by</code>.</p>
        <p><strong>Menu Driven (Descriptives):</strong> <code>Statistics > Summaries, tables, and tests > Summary and descriptive statistics > Summary statistics</code>. Select <code class="no-mathjax-process">final_exam_score</code>, check "Display additional statistics", and then select <code class="no-mathjax-process">used_study_support_services</code> in the "by/if/in" tab under "By groups".</p>
        <pre class="no-mathjax-process"><code>
* Sort the data by the grouping variable
sort used_study_support_services

* Grouped descriptive statistics (for assessing skewness and kurtosis per group)
by used_study_support_services: summarize final_exam_score, detail
            </code></pre>
        <p>For grouped histograms and Q-Q plots, Stata provides powerful tools with the <code class="no-mathjax-process">by()</code> option in graph commands:</p>
        <p><strong>Menu Driven (Histograms):</strong> <code>Graphics > Histogram...</code> Select <code class="no-mathjax-process">final_exam_score</code>, check "Add normal density plot", then go to "By groups" tab and select <code class="no-mathjax-process">used_study_support_services</code>. Choose "Separate subgraphs for each category".</p>
        <p><strong>Menu Driven (Box Plots):</strong> <code>Graphics > Box plot...</code> Select <code class="no-mathjax-process">final_exam_score</code>, then select <code class="no-mathjax-process">used_study_support_services</code> in the "Categorical variables" field. Choose "Plot categories separately".</p>
        <pre class="no-mathjax-process"><code>
* Grouped Histograms
histogram final_exam_score, normal by(used_study_support_services) ///
   title("Histograms of Final Exam Scores by Study Support Services") ///
   xtitle("Final Exam Score") ytitle("Density")
graph export "final_exam_grouped_histograms.png", as(png) replace

* Grouped Box Plots
graph box final_exam_score, over(used_study_support_services) ///
   title("Box Plots of Final Exam Scores by Study Support Services") ///
   ytitle("Final Exam Score")
graph export "final_exam_grouped_boxplots.png", as(png) replace

* Grouped Q-Q Plots
qnorm final_exam_score, by(used_study_support_services) ///
   title("Q-Q Plots of Final Exam Scores by Study Support Services") ///
   xtitle("Normal Quantiles") ytitle("Final Exam Score")
graph export "final_exam_grouped_qqplots.png", as(png) replace
            </code></pre>
            <p>
                The <code class="no-mathjax-process">by()</code> option in Stata's graphing commands creates separate plots for each level of the categorical variable specified inside the parentheses. The <code class="no-mathjax-process">over()</code> option in <code class="no-mathjax-process">graph box</code> creates separate box plots side-by-side for each category.
            </p>

        <h3>2.2 Interpreting Grouped Normality Assessments</h3>
        <p>Examine the output for each group independently, just as you did in Part 1. Pay close attention to:</p>
        <ul>
            <li><code class="no-mathjax-process">Skewness</code> and <code class="no-mathjax-process">Kurtosis</code> values: Are they close to zero (for skewness) and 3 (for raw kurtosis) for each group?</li>
            <li><strong>Calculated Z-scores for Skewness and Kurtosis:</strong> Based on the Skewness/Kurtosis values and the specific \(N\) for each group, calculate the Z-scores using the formulas provided in Section 1.1. Do they suggest significant deviation from normality (e.g., \(|Z| > 1.96\))?</li>
            <li><strong>Histograms:</strong> Do they show a bell shape for each group? Are there differences in symmetry or tails between groups?</li>
            <li><strong>Q-Q Plots:</strong> Do the points follow the line for each group? Are there deviations, especially at the tails?</li>
            <li><strong>Shapiro-Wilk p-values:</strong> For each group, is the p-value \(\ge 0.05\) (suggesting normality) or \(< 0.05\) (suggesting non-normality)?</li>
        </ul>
        <p>To run Shapiro-Wilk for each group, you can again use Stata's <code class="no-mathjax-process">by</code> prefix.</p>
        <p><strong>Menu Driven:</strong> Not directly available from a standard menu, as it's a user-written command. You would run it via the command line or Do-file editor using the <code class="no-mathjax-process">by</code> prefix.</p>
        <pre class="no-mathjax-process"><code>
* Perform Shapiro-Wilk test for each group
by used_study_support_services: shapiro final_exam_score
            </code></pre>

        <div class="reflection-question">
            <h4>Reflection Questions & Tasks (Part 2):</h4>
            <ol>
                <li>For <code class="no-mathjax-process">final_exam_score</code> split by <code class="no-mathjax-process">used_study_support_services</code>, compare the <code class="no-mathjax-process">Skewness</code> and <code class="no-mathjax-process">Kurtosis</code> values for the 'Yes' group vs. the 'No' group from your grouped descriptive statistics. Are both groups still approximately symmetrical and mesokurtic?</li>
                <li>Calculate the Z-scores for Skewness and Kurtosis for both the 'Yes' and 'No' groups for <code class="no-mathjax-process">final_exam_score</code>. Do they suggest significant skewness or kurtosis for either group? (Remember to use the correct \(N\) for each group to calculate SEs).</li>
                <li>Look at the grouped histograms and Q-Q plots. Do both the 'Yes' and 'No' groups visually appear to be normally distributed? Note any subtle differences you observe.</li>
                <li>What are the Shapiro-Wilk p-values for both the 'Yes' and 'No' groups? Do these results suggest normality for both groups, or only one, or neither?</li>
                <li><strong>Task:</strong> Choose another numerical variable (e.g., <code class="no-mathjax-process">anxiety_score_pre</code>) and split it by <code class="no-mathjax-process">used_study_support_services</code>. Perform the grouped normality assessment in Stata and describe your findings. Do the results for the separate groups match your expectation based on the overall sample's normality?</li>
            </ol>
        </div>

        <div class="solution-section">
            <h4>Suggested Solutions for Reflection Questions (Part 2):</h4>
            <ol>
                <li>For <code class="no-mathjax-process">final_exam_score</code> split by <code class="no-mathjax-process">used_study_support_services</code>, you will find:
                    <ul>
                        <li><strong>'No' Group (\(N=48\)):</strong> Skewness = 0.31, Kurtosis = 3.31.</li>
                        <li><strong>'Yes' Group (\(N=52\)):</strong> Skewness = 0.20, Kurtosis = 2.44.</li>
                    </ul>
                    Both are relatively close to zero skewness and a kurtosis of 3, suggesting both groups maintain approximate symmetry and mesokurtic characteristics, though the 'Yes' group might be slightly flatter (more platykurtic) than the 'No' group.</li>
                <li>For <code class="no-mathjax-process">final_exam_score</code> split by <code class="no-mathjax-process">used_study_support_services</code>:
                    <ul>
                        <li><strong>'No' Group (\(N=48\)):</strong>
                            \(SE_{\text{skew}} \approx \sqrt{\frac{6}{48}} = \sqrt{0.125} \approx 0.3536\).
                            \(SE_{\text{kurt}} \approx \sqrt{\frac{24}{48}} = \sqrt{0.5} \approx 0.7071\).
                            \(Z_{\text{skew}} = \frac{0.31}{0.3536} \approx 0.88\).
                            \(Z_{\text{kurt}} = \frac{3.31 - 3}{0.7071} = \frac{0.31}{0.7071} \approx 0.44\).
                            Both absolute Z-scores are below 1.96, indicating no statistically significant skewness or kurtosis for this group.</li>
                        <li><strong>'Yes' Group (\(N=52\)):</strong>
                            \(SE_{\text{skew}} \approx \sqrt{\frac{6}{52}} = \sqrt{0.1154} \approx 0.3397\).
                            \(SE_{\text{kurt}} \approx \sqrt{\frac{24}{52}} = \sqrt{0.4615} \approx 0.6794\).
                            \(Z_{\text{skew}} = \frac{0.20}{0.3397} \approx 0.59\).
                            \(Z_{\text{kurt}} = \frac{2.44 - 3}{0.6794} = \frac{-0.56}{0.6794} \approx -0.82\).
                            Both absolute Z-scores are below 1.96, indicating no statistically significant skewness or kurtosis for this group.</li>
                    </ul>
                    These Z-scores indicate that both groups' distributions for final exam scores do not significantly deviate from normal based on skewness and kurtosis.</li>
                <li>Visually, both grouped histograms for <code class="no-mathjax-process">final_exam_score</code> will still appear relatively bell-shaped. The Q-Q plots will show points generally following the line for both groups, reinforcing their approximate normality. You might observe the 'Yes' group's distribution appearing slightly narrower and more uniform, consistent with its slightly negative kurtosis (relative to 3).</li>
                <li>For <code class="no-mathjax-process">final_exam_score</code> split by <code class="no-mathjax-process">used_study_support_services</code>, you will find:
                    <ul>
                        <li><strong>'No' Group (\(N=48\)):</strong> Shapiro-Wilk \(p = 0.50\) (approximate). Conclusion: The 'No' group's final exam scores are normally distributed.</li>
                        <li><strong>'Yes' Group (\(N=52\)):</strong> Shapiro-Wilk \(p = 0.65\) (approximate). Conclusion: The 'Yes' group's final exam scores are normally distributed.</li>
                    </ul>
                    These results suggest normality for both groups based on Shapiro-Wilk, confirming that the overall normality of <code class="no-mathjax-process">final_exam_score</code> holds true even when divided by <code class="no-mathjax-process">used_study_support_services</code>.</li>
                <li><strong>Task Solution (for <code class="no-mathjax-process">anxiety_score_pre</code> split by <code class="no-mathjax-process">used_study_support_services</code>):</strong>
                    <ul>
                        <li>Overall, <code class="no-mathjax-process">anxiety_score_pre</code> is positively skewed (Skewness = 0.80) with a \(Z_{\text{skew}} \approx 3.27\) and Shapiro-Wilk \(p = 0.001\), indicating it is <strong>not</strong> normally distributed for the whole sample.</li>
                        <li>When split:
                            <ul>
                                <li><strong>'No' Study Support Group (\(N=48\)):</strong> Skewness = 1.20, Kurtosis = 5.0.
                                    \(SE_{\text{skew}} \approx 0.3536\), \(SE_{\text{kurt}} \approx 0.7071\).
                                    \(Z_{\text{skew}} = \frac{1.20}{0.3536} \approx 3.39\).
                                    \(Z_{\text{kurt}} = \frac{5.0 - 3}{0.7071} \approx 2.83\).
                                    Both Z-scores are greater than 1.96, indicating statistically significant skewness and kurtosis. Shapiro-Wilk \(p = 0.005\).
                                    Conclusion: This subgroup's <code class="no-mathjax-process">anxiety_score_pre</code> is <strong>not</strong> normally distributed, strongly indicated by the significant Z-scores and the Shapiro-Wilk test. The histogram will show a pronounced positive skew and a higher peak, and the Q-Q plot will show significant deviations from the line, especially at the higher end.</li>
                                <li><strong>'Yes' Study Support Group (\(N=52\)):</strong> Skewness = 0.30, Kurtosis = 2.80.
                                    \(SE_{\text{skew}} \approx 0.3397\), \(SE_{\text{kurt}} \approx 0.6794\).
                                    \(Z_{\text{skew}} = \frac{0.30}{0.3397} \approx 0.88\).
                                    \(Z_{\text{kurt}} = \frac{2.80 - 3}{0.6794} \approx -0.29\).
                                    Both Z-scores are below 1.96. Shapiro-Wilk \(p = 0.20\).
                                    Conclusion: This subgroup's <code class="no-mathjax-process">anxiety_score_pre</code> <strong>is</strong> normally distributed, supported by all three methods. The histogram will appear more symmetrical, and the Q-Q plot's points will mostly follow the diagonal line.</li>
                            </ul>
                        </li>
                        <li><strong>Finding:</strong> This shows that while the overall <code class="no-mathjax-process">anxiety_score_pre</code> is not normal, the distribution differs significantly between groups, with one subgroup exhibiting non-normality more strongly, while the other is normally distributed. This clearly highlights the importance of checking normality by groups.</li>
                    </ul>
                </li>
            </ol>
        </div>

        <hr>

        <h2>Part 3: Using Stata Do-files for Reproducible Analysis</h2>
        <p>A "Do-file" (often saved as a <code class="no-mathjax-process">.do</code> file) is a text file containing a sequence of Stata commands. Running a Do-file is like typing each command into the Command window one by one, but it allows you to automate your analysis, ensure reproducibility, and keep a clear record of your steps. This is a best practice in quantitative research.</p>

        <h3>3.1 Creating and Running a Stata Do-file</h3>
        <ol>
            <li><strong>Open a new Do-file Editor:</strong> In Stata, go to <code>Window > Do-file Editor > New Do-file Editor</code> (or click the "New Do-file Editor" icon on the toolbar, which looks like a piece of paper with a pencil).</li>
            <li><strong>Copy Commands:</strong> Copy all the Stata commands provided below into the new Do-file Editor window.</li>
            <li><strong>Save the Do-file:</strong> Go to <code>File > Save As...</code> in the Do-file Editor. Save your Do-file with a <code class="no-mathjax-process">.do</code> extension (e.g., <code class="no-mathjax-process">normality_analysis.do</code>) in the same directory as your <code class="no-mathjax-process">omni.csv</code> file, or note its path.</li>
            <li><strong>Run the Do-file:</strong>
                <ul>
                    <li>**To run specific lines:** Select the lines of code you want to run in the Do-file Editor, then click the "Execute (do)" button (looks like a "Do" icon) or press <code>Ctrl + D</code> (Windows/Linux) / <code>Cmd + D</code> (Mac).</li>
                    <li>**To run the entire file:** Click the "Execute (do)" button without selecting any specific lines. This runs the entire Do-file from top to bottom. Alternatively, type <code class="no-mathjax-process">do normality_analysis.do</code> (replacing with your file name) in the Stata Command window and press Enter.</li>
                </ul>
            </li>
            <p>Running the Do-file will execute all the commands, producing the same output and graphs as if you typed them manually, but much faster and more reliably.</p>
        </ol>

        <h3>3.2 Commands for Your Stata Do-file</h3>
        <p>Below are all the Stata commands used throughout this guide, organised for easy copying into your Do-file. Remember that lines starting with <code class="no-mathjax-process">*</code> are comments and will not be executed by Stata. Lines ending with <code class="no-mathjax-process">///</code> indicate that the command continues on the next line.</p>
        <pre class="no-mathjax-process"><code>
* --- Stata Do-file for Normality Assessment ---

* Clear any existing data from memory for a fresh start
clear all

* Set your working directory (uncomment and modify if needed)
* cd "C:/Users/YourUser/YourDataFolder"

* Import the CSV file
import delimited using "omni.csv", clear

* --- Part 1: Assessing Normality for a Single Interval/Ratio Variable (Whole Sample) ---

* Get detailed descriptive statistics for final_exam_score (including skewness and kurtosis)
summarize final_exam_score, detail


* Create a histogram of final_exam_score with a normal density overlay
histogram final_exam_score, normal title("Histogram of Final Exam Scores with Normal Curve") ///
   xtitle("Final Exam Score") ytitle("Density")
graph export "final_exam_score_histogram.png", as(png) replace

* Create a Q-Q plot for final_exam_score
qnorm final_exam_score, title("Normal Q-Q Plot of Final Exam Scores") ///
   xtitle("Normal Quantiles") ytitle("Final Exam Score")
graph export "final_exam_score_qqplot.png", as(png) replace

* Install shapiro command if not already installed (user-written)
ssc install shapiro, replace

* Perform the Shapiro-Wilk Normality Test for final_exam_score
shapiro final_exam_score


* --- Part 1: Analyzing study_hours_per_week (Task) ---

* Get detailed descriptive statistics for study_hours_per_week
summarize study_hours_per_week, detail

* Create a histogram of study_hours_per_week with a normal density overlay
histogram study_hours_per_week, normal title("Histogram of Study Hours per Week with Normal Curve") ///
   xtitle("Study Hours per Week") ytitle("Density")
graph export "study_hours_histogram.png", as(png) replace

* Create a Q-Q plot for study_hours_per_week
qnorm study_hours_per_week, title("Normal Q-Q Plot of Study Hours per Week") ///
   xtitle("Normal Quantiles") ytitle("Study Hours per Week")
graph export "study_hours_qqplot.png", as(png) replace

* Perform the Shapiro-Wilk Normality Test for study_hours_per_week
shapiro study_hours_per_week


* --- Part 2: Assessing Normality for Groups (final_exam_score by used_study_support_services) ---

* Sort the data by the grouping variable for 'by' prefix
sort used_study_support_services

* Grouped descriptive statistics (for assessing skewness and kurtosis per group)
by used_study_support_services: summarize final_exam_score, detail

* Grouped Histograms for final_exam_score
histogram final_exam_score, normal by(used_study_support_services) ///
   title("Histograms of Final Exam Scores by Study Support Services") ///
   xtitle("Final Exam Score") ytitle("Density")
graph export "final_exam_grouped_histograms.png", as(png) replace

* Grouped Box Plots for final_exam_score
graph box final_exam_score, over(used_study_support_services) ///
   title("Box Plots of Final Exam Scores by Study Support Services") ///
   ytitle("Final Exam Score")
graph export "final_exam_grouped_boxplots.png", as(png) replace

* Grouped Q-Q Plots for final_exam_score
qnorm final_exam_score, by(used_study_support_services) ///
   title("Q-Q Plots of Final Exam Scores by Study Support Services") ///
   xtitle("Normal Quantiles") ytitle("Final Exam Score")
graph export "final_exam_grouped_qqplots.png", as(png) replace

* Perform Shapiro-Wilk test for each group for final_exam_score
by used_study_support_services: shapiro final_exam_score


* --- Part 2: Analyzing anxiety_score_pre by used_study_support_services (Task) ---

* Grouped descriptive statistics (for assessing skewness and kurtosis per group)
by used_study_support_services: summarize anxiety_score_pre, detail

* Grouped Histograms for anxiety_score_pre
histogram anxiety_score_pre, normal by(used_study_support_services) ///
   title("Histograms of Pre-Anxiety Scores by Study Support Services") ///
   xtitle("Pre-Anxiety Score") ytitle("Density")
graph export "anxiety_grouped_histograms.png", as(png) replace

* Grouped Box Plots for anxiety_score_pre
graph box anxiety_score_pre, over(used_study_support_services) ///
   title("Box Plots of Pre-Anxiety Scores by Study Support Services") ///
   ytitle("Pre-Anxiety Score")
graph export "anxiety_grouped_boxplots.png", as(png) replace

* Grouped Q-Q Plots for anxiety_score_pre
qnorm anxiety_score_pre, by(used_study_support_services) ///
   title("Q-Q Plots of Pre-Anxiety Scores by Study Support Services") ///
   xtitle("Normal Quantiles") ytitle("Pre-Anxiety Score")
graph export "anxiety_grouped_qqplots.png", as(png) replace

* Perform Shapiro-Wilk test for each group for anxiety_score_pre
by used_study_support_services: shapiro anxiety_score_pre

* --- End of Stata Do-file ---
        ```</p